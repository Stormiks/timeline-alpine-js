<!DOCTYPE html>
<html lang="ru">

  <head>
    <meta charset="utf-8">
    <meta
      http-equiv="X-UA-Compatible"
      content="IE=edge"
    >
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0"
    >
    <title>
      Timeline Alpine.JS
    </title>
    <link
      rel="stylesheet/less"
      type="text/css"
      href="/assets/vendors/bootstrap/less/bootstrap.less?v=3.4.1"
    >
    <link
      rel="stylesheet/less"
      type="text/css"
      href="/assets/less/style.less"
    >
    <script>
      const less = {
        env: "development",
        async: true,
        fileAsync: true,
        poll: 1000,
        functions: {},
        dumpLineNumbers: "comments",
        relativeUrls: false,
        rootpath: "/"
      };
    </script>
    <script src="/assets/vendors/less/less.js?v=4.1.3"></script>
  </head>

  <body class="body">
    <div x-data="timeline">
      <div class="container">
        <div class="page-header">
          <span id="timeline-header">Timeline</span>
        </div>
        <ul class="timeline">
          <template
            x-for="(item, itemIndex) in timeline"
            :key="'t-item' + item.id + '-ixd-' + itemIndex"
          >
            <li class="timeline-item">
              <div
                x-bind:class="item.icon_status"
                class="timeline-badge"
              >
                <i x-bind:class="item.icon_class"></i>
              </div>
              <div
                class="timeline-panel"
                x-on:mouseenter.stop="() => {
                  if (item.controls) $(`#panel-controls-${item.id}-${itemIndex}`).show(300)
                }"
                x-on:mouseleave.stop="() => {
                  if (item.controls) $(`#panel-controls-${item.id}-${itemIndex}`).hide(300)
                }"
              >
                <div class="timeline-heading">
                  <h4
                    class="timeline-title"
                    x-text="item.title"
                  ></h4>
                  <div class="timeline-panel-controls">
                    <template x-if="item.controls">
                      <div
                        class="controls"
                        style="display: none;"
                        x-bind:id="`panel-controls-${item.id}-${itemIndex}`"
                      >
                        <template x-if="item.id === itemEditId">
                          <button
                            class="btn btn-timeline-control"
                            type="button"
                            x-on:click="handleSave(itemIndex)"
                          >
                            <i class="glyphicon glyphicon glyphicon-floppy-saved"></i>
                          </button>
                        </template>
                        <template x-if="item.id !== itemEditId">
                          <button
                            class="btn btn-timeline-control"
                            type="button"
                            x-on:click="handleEdit({item, ixd: itemIndex})"
                          >
                            <i class="glyphicon glyphicon-pencil"></i>
                          </button>
                        </template>
                        <button
                          class="btn btn-timeline-control"
                          type="button"
                          x-on:click="handleDelete(item)"
                        >
                          <i class="glyphicon glyphicon-trash"></i>
                        </button>
                      </div>
                    </template>
                    <div class="timestamp">
                      <small
                        class="text-muted"
                        x-text="parseCreated(item.created)"
                      ></small>
                    </div>
                  </div>
                </div>
                <div
                  class="timeline-body"
                  x-bind:id="'timelime-item' + item.id"
                  x-html="item.body"
                ></div>
              </div>
            </li>
          </template>
        </ul>
      </div>

      <span class="copy">
        <span>
          Базируется на примере из <a href="https://codepen.io/chrgl86/pen/rMOajm">Codepen</a>
        </span><br />
        <span>
          Автор: <b>Chris</b>
        </span><br />
        <span>
          Статья из коллекции <a href="https://vuejsexamples.com/a-simple-timeline-with-vue-js/">vuejsexamples.com</a>
        </span>
      </span>
    </div>

    <script src="/assets/vendors/jquery/jquery.js?v=3.6.0"></script>
    <script src="/assets/vendors/bootstrap/js/bootstrap.js?v=3.4.1"></script>
    <script src="/assets/vendors/lodash/lodash.js?v=4.17.21"></script>
    <script src="/assets/vendors/dayjs/localizedFormat.js?v=1.11.3"></script>
    <script src="/assets/vendors/dayjs/utc.js?v=1.11.3"></script>
    <script src="/assets/vendors/dayjs/timezone.js?v=1.11.3"></script>
    <script src="/assets/vendors/dayjs/dayjs.min.js?v=1.11.3"></script>
    <script src="/assets/vendors/dayjs/ru.js?v=1.11.3"></script>
    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('timeline', () => ({
          timeline: [
            {
              id: 5,
              icon_class: 'glyphicon glyphicon-comment',
              icon_status: '',
              title: 'Admin added a comment.',
              controls: true,
              created: '24. Sep 17:03',
              body: '<p><i>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam, maxime alias nam dignissimos natus voluptate iure deleniti. Doloremque, perspiciatis voluptas dignissimos ex, ullam et, reprehenderit similique possimus iste commodi minima fugiat non culpa, veniam temporibus laborum. Distinctio ipsam cupiditate debitis aliquid deleniti consectetur voluptates corporis officiis tempora minus veniam, accusamus cum optio nesciunt illo nulla odio? Quidem nesciunt, omnis at quo aliquam porro amet fugit mollitia minus explicabo, possimus deserunt rem ut commodi laboriosam quia. Numquam, est facilis rem iste voluptatum. Cupiditate porro fuga saepe quis nulla mollitia, magni dicta soluta distinctio tempore voluptate quo perferendis. Maiores eveniet deleniti, nemo.</i></p>'
            },
            {
              id: 4,
              icon_class: 'glyphicon glyphicon-edit',
              icon_status: 'success',
              title: 'Started editing',
              controls: false,
              created: '24. Sep 14:48',
              body: '<p>Someone has started editing.</p>'
            },
            {
              id: 3,
              icon_class: 'glyphicon glyphicon-hand-right',
              icon_status: 'warning',
              title: 'Message delegated',
              controls: false,
              created: '23. Sep 11:12',
              body: '<p>This message has been delegated.</p>'
            },
            {
              id: 2,
              icon_class: 'glyphicon glyphicon-map-marker',
              icon_status: 'danger',
              title: 'Message approved and forwarded',
              controls: false,
              created: '20. Sep 15:56',
              body: '<p>Message has been approved and forwarded to responsible.</p>'
            },
            {
              id: 1,
              icon_class: 'glyphicon glyphicon-map-marker',
              icon_status: '',
              title: 'Message forwarded for approval',
              controls: false,
              created: '19. Sep 19:49',
              body: '<p>Message has been forwarded for approval.</p>'
            },
          ],
          selectedItem: null,
          itemEditId: null,
          timelineDeleteItem(id) {
            this.timeline = _.remove(this.timeline, (item) => item.id !== id);
          },
          handleDelete(item) {
            this.timelineDeleteItem(item.id);
          },
          handleEdit({ item, ixd }) {
            if (this.itemEditId && this.itemEditId !== item.id) {
              editor.destroy()
            }

            this.selectedItem = this.timeline[ixd];
            this.itemEditId = item.id;

            ClassicEditor
              .create(document.querySelector('#timelime-item' + item.id), {
                language: 'ru'
              })
              .then((editor) => {
                window.editor = editor;
              })
              .catch(error => {
                console.error(error);
              });
          },
          handleSave(timelineItemIxd) {
            this.timeline[timelineItemIxd].body = editor.getData();

            editor.destroy().then(() => {
              this.selectedItem = null
              this.itemEditId = null
            });
          },
          parseCreated(strDate) {
            return dayjs(strDate).format('ll');
          },
          init() {
            dayjs.locale($('html').attr('lang'));
            dayjs.extend(window.dayjs_plugin_utc);
            dayjs.extend(window.dayjs_plugin_timezone);
            dayjs.extend(window.dayjs_plugin_localizedFormat);
            dayjs.tz.setDefault('Asia/Krasnoyarsk');
          }
        }));
      });

      document.addEventListener('alpine:initialized', () => {
        document.write("<script defer src='/assets/vendors/ckeditorjs/ckeditor.js'><\/script><script defer src='/assets/vendors/ckeditorjs/ru.js'><\/script>");
      });
    </script>
    <script src="/assets/vendors/alpinejs/cdn.js?v=3.10.3"></script>
  </body>

</html>
